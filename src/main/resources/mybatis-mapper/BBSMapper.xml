<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="project3.yakdo.repository.mybatis.BBSMapper">

	<!-- 게시글 작성 -->
	<insert id="insertBBS" parameterType="BBS">
		<selectKey keyProperty="bbsNo" resultType="java.lang.Integer"
		order="BEFORE">
		select BBSPK.nextVal as BBS_no from dual
		</selectKey>
		insert into BBS
		(
		BBS_no,
		user_no,
		BBS_title,
		BBS_content,
		BBS_date,
		BBS_show
		)
		values
		(
		#{bbsNo},
		<!-- #{user_no}, 일단 Test로 3 넣어보기, 추후 수정 필요 - 로그인한 사람 아이디에 맞는 user_no찾아서 insert -->
		3,
		#{bbsTitle},
		#{bbsContent},
		<!-- #{BBS_date} 는 #{sysdate} -->
		sysdate,
<!-- 		to_char(sysdate.'YYYY-MM-DD HH24:MI:SS'), -->
		<!-- #{BBS_show} 는 일단 글 등록하면 게시해야하니까 값을 0으로 넣어줌 -->
		0
		)
	</insert>

	<!-- 게시글 읽기 -->
	<select id="selectBybbsNo" resultType="BBS">
		<!-- 게시글 클릭시 선택한 게시글 보여주기 -->
		<!-- 게시글 보여줄때 user_no에 맞는 닉네임 찾아서 같이 출력되어야함 -->
		<!-- select -->
		<!-- b.BBS_no, -->
		<!-- b.BBS_title, -->
		<!-- b.BBS_content, -->
		<!-- b.BBS_date, -->
		<!-- u.user_nick -->
		<!-- from -->
		<!-- BBS b , users u -->
		<!-- WHERE b.BBS_no = #{BBS_no} -->
		<!-- 테스트용 쿼리 -->
		<!-- select -->
		<!-- BBS_title, -->
		<!-- BBS_content, -->
		<!-- BBS_date -->
		<!-- from BBS -->
		<!-- where BBS_no = #{BBS_no} -->
		select 
		BBS_no,
		user_no,
		BBS_title,
		BBS_content,
		BBS_date,
		BBS_show
		from BBS
		where
		BBS_no = #{bbsNo}


	</select>

	<!-- 게시글 전체 목록 보기 -->
	<select id="selectByShowZero" resultType="BBS">
		<!-- BBS_show 값이 0(게시) 1(본인삭제) 2(관리자삭제) 이기 때문에 0인것만 목록에 출력 -->
		<!-- 데이터 안넘어와서 테스트용 쿼리로 변경함 / 추후 수정 예정 -->
		<!-- 쿼리 수정 완료 -->
		select
		b.BBS_no,
		b.user_no,
		u.user_nick,
		b.BBS_title,
		b.BBS_content,
		b.BBS_date,
		b.BBS_show
		from BBS b, users u
		where b.BBS_show = 0
		and u.user_no = b.user_no
		order by BBS_no desc
		<!-- 위의 쿼리로 실행하면 SQL state [99999]; error code [17132]; 부적합한 변환이 요청됨 에러 -->
		<!-- 실제로 필요한 결과 데이터를 불러오려면 위의 쿼리가 필요한것같은데...일단 주석 12-21-09:47 -->
	</select>


	<!-- 게시글 수정 -->
	<update id="updateBBS" parameterType="BBS">
		update BBS
		set
		BBS_title=#{updateItem.bbsTitle},
		BBS_content=#{updateItem.bbsContent}
		where BBS_no=#{bbsNo}
	</update>

	<!-- 본인 삭제 / 게시글 전체 목록에서 숨기기 -->
	<update id="updateShowOneBybbsNo">
		update BBS
		set BBS_show=1
		where BBS_no=#{bbsNo}
	</update>

	<!-- 관리자 삭제 / 게시글 전체 목록에서 숨기기 -->
	<update id="updateShowTwoBybbsNo">
		update BBS
		set BBS_show=2
		where BBS_no=#{bbsNo}
	</update>

<!-- 회원이 삭제한 게시글 목록  -->
	<select id="selectByShowOne" resultType="BBS">
		  select
		BBS_no,
		user_no,
		BBS_title,
		BBS_content,
		BBS_date,
		BBS_show
		from BBS b
		where BBS_show=1
		order by BBS_no desc
	</select>
	
<!-- 	관리자가 삭제한 게시글 목록 불러오기 -->
	<select id="selectByShowTwo" resultType="BBS">
		  select
		BBS_no,
		user_no,
		BBS_title,
		BBS_content,
		BBS_date,
		BBS_show
		from BBS b
		where BBS_show=2
		order by BBS_no desc
	</select>


</mapper>
